{% extends 'SoccerStats/base.html' %}

{% load humanize %}
{% load static %}

{# TODO Implement Scrollspy #}

{% block content %}
    <div class="card">
        <div class="card-header">
            <h3 class="card-title>">Wettbewerbe</h3>
            <span class="badge badge-pill badge-default">{{ competition.count }} Wettbewerbe</span>
            <span class="badge badge-pill badge-default">{{ competition.team.count }} Mannschaften</span>
        </div>
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th>Wettbewerb</th>
                    <th>Aktueller Spieltag</th>
                </tr>
                </thead>
                <tbody>
                {% for competition in competition.list %}
                    <tr
                            onclick="document.location='{% url 'competition:detail' competition.id %}'"
                            style="cursor:pointer;"
                    >
                        <td>{{ competition.caption }}</td>
                        <td>{{ competition.current_matchday }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <hr>
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Begegnungen</h3>
            <span class="badge badge-pill badge-default">{{ fixture.count }} Begegnungen</span>
            <span class="badge badge-pill badge-default">⌀{{ fixture.result_avg.goals_home_team }} Tore</span>
            <span class="badge badge-pill badge-default">⌀{{ fixture.result_avg.goals_away_team }} Gegentore</span>
        </div>
        <ul class="list-group list-group-flush">
            {% for last_five in fixture.last_five %}
                <a href="{% url 'fixture:detail' last_five.id %}" class="list-group-item list-group-item-action">
                    <div class="row">
                        <div class="col-2">
                            <img
                                    class="img-fluid"
                                    src="{{ last_five.home_team.crest_url }}"
                                    alt="={{ last_five.home_team.name }}"
                                    onerror="this.src='{% static 'SoccerStats/assets/team.svg' %}'"
                            >
                        </div>
                        <div class="col text-center">
                            <h4 class="card-title">
                                {{ last_five.home_team.name }} vs. {{ last_five.away_team.name }}
                            </h4>
                            <p class="card-text">
                                {{ last_five.result_set.all.0.goals_home_team }}
                                :
                                {{ last_five.result_set.all.0.goals_away_team }}
                                {% if last_five.result_set.all.0.halftime_set.all %}
                                    (
                                    {{ last_five.result_set.all.0.halftime_set.all.0.goals_home_team }}
                                    :
                                    {{ last_five.result_set.all.0.halftime_set.all.0.goals_away_team }}
                                    )
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-2">
                            <img
                                    class="img-fluid"
                                    src="{{ last_five.away_team.crest_url }}"
                                    alt="={{ last_five.away_team.name }}"
                                    onerror="this.src='{% static 'SoccerStats/assets/team.svg' %}'"
                            >
                        </div>
                    </div>
                </a>
            {% endfor %}
        </ul>
    </div>
    <hr>
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Spieler</h3>
            <span class="badge badge-pill badge-default">{{ player.count }} Spieler</span>
            <span class="badge badge-pill badge-default">⌀{{ player.market_value.avg|intword }} € Marktwert</span>
        </div>
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Mannschaft</th>
                    <th>Position</th>
                    <th>Marktwert</th>
                </tr>
                </thead>
                <tbody>
                {% for best_five in player.best_five %}
                    <tr
                            onclick="document.location='{% url 'player:detail' best_five.id %}'"
                            style="cursor: pointer;"
                    >
                        <td>{{ best_five.name }}</td>
                        <td>{{ best_five.team.name }}</td>
                        <td>{{ best_five.position }}</td>
                        <td>{{ best_five.market_value|intword }} €</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <hr>
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Tabellen</h3>
            <span class="badge badge-pill badge-default">{{ table.count }} Wettbewerbe</span>
        </div>
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th>Wettbewerb</th>
                    <th>Aktueller Spieltag</th>
                </tr>
                </thead>
                <tbody>
                {% for table in table.list %}
                    <tr
                            onclick="document.location = '{% url 'table:detail' table.id %}'"
                            style="cursor: pointer"
                    >
                        <td>{{ table.competition.caption }}</td>
                        {% if table.competition.number_of_matchdays == table.matchday %}
                            <td>{{ table.matchday }} (Beendet)</td>
                        {% else %}
                            <td>{{ table.matchday }}</td>
                        {% endif %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <hr>
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Mannschaften</h3>
            <span class="badge badge-pill badge-default">{{ team.count }} Mannschaften</span>
            <span class="badge badge-pill badge-default">⌀{{ team.squad_market_value.avg|intword }} € Mannschaftswert</span>
        </div>
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th>Verein</th>
                    <th>Mannschaftswert</th>
                </tr>
                </thead>
                <tbody>
                {% for best_five in team.best_five %}
                    <tr
                            onclick="document.location = '{% url 'team:detail' best_five.id %}'"
                            style="cursor: pointer"
                    >
                        <td>{{ best_five.name }}</td>
                        <td>{{ best_five.squad_market_value|intword }} €</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}